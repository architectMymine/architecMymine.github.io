<!DOCTYPE html>

<html lang="zh-CN" >

<head>
  
  <title>安卓、ios微信H5分享踩坑指南 - RadiomM的博客世界</title>
  <meta charset="UTF-8">
  <meta name="description" content="web前端开发的有趣学习者">
  <meta name="baidu-site-verification" content="LHWFIbYYHZ" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="1f8c7b61089021ddab0a2109105def2b" />

  <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@static/static/images/avatar1.png" type="image/png" />
  <meta name="description" content="博主最近在开发一个H5的项目，正好遇到了微信分享，不得不说微信的文档不知多久没更新的缘故，里面的操作可以在安卓完美的进行，但是！有一个可恶的苹果挡住了去路！闲话不多说，直接进去正题。附上步骤图">
<meta property="og:type" content="article">
<meta property="og:title" content="安卓、ios微信H5分享踩坑指南">
<meta property="og:url" content="http://yoursite.com/2020/12/07/%E5%AE%89%E5%8D%93%E3%80%81ios%E5%BE%AE%E4%BF%A1H5%E5%88%86%E4%BA%AB%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="RadiomM的博客世界">
<meta property="og:description" content="博主最近在开发一个H5的项目，正好遇到了微信分享，不得不说微信的文档不知多久没更新的缘故，里面的操作可以在安卓完美的进行，但是！有一个可恶的苹果挡住了去路！闲话不多说，直接进去正题。附上步骤图">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201207111101984.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201207111033878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201207112249794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center">
<meta property="article:published_time" content="2020-12-07T09:31:25.000Z">
<meta property="article:modified_time" content="2020-12-07T09:31:25.000Z">
<meta property="article:author" content="RadiomM">
<meta property="article:tag" content="Wx生态的那些事">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20201207111101984.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center">
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/combine/gh/nexmoe/nexmoe.github.io@latest/css/style.css,npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/nexmoe/nexmoe.github.io@latest/lib/mdui_043tiny/css/mdui.css,gh/nexmoe/nexmoe.github.io@latest/lib/iconfont/iconfont.css"
    crossorigin>
  
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/css/APlayer.min.css">
  <!--<link rel="stylesheet" href="/css/style.css?v=1633917914765">-->

  
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="RadiomM的博客世界" type="application/atom+xml">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://s2.hdslb.com/bfs/static/blive/blfe-message-web/static/img/infocenterbg.a1a0d152.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i
            class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="RadiomM" class="mdui-btn mdui-btn-icon"><img
            src="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/static/images/avatar1.png" alt="RadiomM"></a>
      </div>
    </div>
  </div>
  <div id="nexmoe-header">
    <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="RadiomM">
            <img src="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/static/images/avatar1.png" alt="RadiomM" alt="RadiomM">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>13</div>
        <div><span>标签</span>10</div>
        <div><span>分类</span>1</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about" title="个人简介">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                个人简介
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=https://architectmymine.github.io" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">社交按钮</h3>
    <div class="nexmoe-widget nexmoe-social">
        
        <a class="mdui-ripple" href="https://space.bilibili.com/86206061"
            target="_blank" mdui-tooltip="{content: '哔哩哔哩'}"
            style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a>
        <a class="mdui-ripple" href="https://github.com/architectMymine"
            target="_blank" mdui-tooltip="{content: 'GitHub'}"
            style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
        <a class="mdui-ripple" href="tencent://message/?uin=516782176&Site=&Menu=yes"
            target="_blank" mdui-tooltip="{content: 'QQ'}"
            style="color: rgb(27,193,250);background-color: rgba(27,193,250, .15);">
            <i class="nexmoefont icon-QQ"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/web前端/">web前端</a>
          <span class="category-list-count">13</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">标签云</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Jquery/" style="font-size: 10px;">Jquery</a> <a href="/tags/VScode/" style="font-size: 10px;">VScode</a> <a href="/tags/Wx%E7%94%9F%E6%80%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/" style="font-size: 10px;">Wx生态的那些事</a> <a href="/tags/canvas/" style="font-size: 10px;">canvas</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a> <a href="/tags/%E9%82%A3%E4%BA%9B%E7%83%A6%E4%BA%BA%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" style="font-size: 20px;">那些烦人的项目搭建</a> <a href="/tags/%E9%82%A3%E4%BA%9B%E8%AE%A8%E4%BA%BA%E5%8E%8C%E7%9A%84%E9%9C%80%E6%B1%82/" style="font-size: 10px;">那些讨人厌的需求</a>
    </div>
    
  </div>

  
  <!-- 
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li></ul>
    </div>
  </div>
 -->

<!-- 文件归档 -->
  
  <style>
    .about-me {
        margin: 5px 0;
    }

    .music-wrapper {
        box-shadow: 0 0 1rem rgba(161, 177, 204, .4);
        background-color: #fff;
        margin: 20px;
        overflow: hidden;
        white-space: normal;
    }
    .music-wrapper .aplayer{
        height: auto !important;
        margin: 0 !important;
    }
    .music-wrapper .aplayer .aplayer-body{
        padding-bottom: 10px;
    }
    .music-wrapper .aplayer.aplayer-withlrc .aplayer-pic{
        /* width: 95px;
        height: 95px; */
    }
    .music-wrapper .aplayer.aplayer-withlist .aplayer-info{
        /* margin-left: 95px;
        height: 95px; */
        border: none;
    }
</style>
<div class="music-wrapper">
    <div id="player"></div>
</div>
  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 RadiomM
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
        <p class="copyright"><a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20034857号</a></p>
    </div>
</div><!-- .nexmoe-drawer -->



  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
      <div class="nexmoe-post">
  
      <div class="nexmoe-post-cover" style="padding-bottom: 56.25%;"> 
          <img data-src="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/static/cover/2020-12-07.jpg" data-sizes="auto" alt="安卓、ios微信H5分享踩坑指南" class="lazyload">
          <h1>安卓、ios微信H5分享踩坑指南</h1>
      </div>
  
  
  <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年12月07日</a>
    <a><i class="nexmoefont icon-areachart"></i>2.3k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 10 分钟</a>
</div>

  <div class="nexmoe-post-right">
    
      <div class="nexmoe-fixed">
        <div class="nexmoe-valign">
            <div class="nexmoe-toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、判断是否需要微信授权"><span class="toc-number">1.</span> <span class="toc-text">一、判断是否需要微信授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、获取config配置以及如何携带参数"><span class="toc-number">2.</span> <span class="toc-text">二、获取config配置以及如何携带参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-config配置注入"><span class="toc-number">2.0.1.</span> <span class="toc-text">2.1  config配置注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-分享链接带参数"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.2 分享链接带参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、分享操作"><span class="toc-number">3.</span> <span class="toc-text">三、分享操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-全局配置"><span class="toc-number">3.0.1.</span> <span class="toc-text">3.1 全局配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-独立配置-指定某个页面分享"><span class="toc-number">3.0.2.</span> <span class="toc-text">3.2 独立配置(指定某个页面分享)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整代码"><span class="toc-number">4.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol>
            </div>
        </div>
      </div>
    
  </div>

  <article>
    <p>博主最近在开发一个H5的项目，正好遇到了微信分享，不得不说微信的文档不知多久没更新的缘故，里面的操作可以在安卓完美的进行，但是！有一个可恶的苹果挡住了去路！闲话不多说，直接进去正题。附上步骤图</p>
<a id="more"></a>

<p><img data-sizes="auto" data-src="https://img-blog.csdnimg.cn/20201207111101984.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center" alt="步骤1" class="lazyload"></p>
<h2 id="一、判断是否需要微信授权"><a href="#一、判断是否需要微信授权" class="headerlink" title="一、判断是否需要微信授权"></a>一、判断是否需要微信授权</h2><p>根据<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#2" target="_blank" rel="noopener">微信JSSDK文档</a>，一般来说后端需要配置白名单。进入公众号里面填写JS接口安全域名，这点很重要，因为这样才能获取到正确的config配置。按照我现在的项目，我们前端主要做的就是判断用户有没有openid，没有的话就让他去微信登录授权。那该怎么判断呢？没错只能在地址里判断有没有code码，没有code码的时候，我们就让他去进行微信授权。</p>
<pre><code class="highlight stylus"><span class="function"><span class="title">if</span><span class="params">(window.location.href.includes(<span class="string">'code='</span>)</span></span>&#123;
 	<span class="comment">// 有code码的时候进行的操作</span>
&#125; <span class="keyword">else</span>&#123;
	<span class="comment">// 没有code码时候要进行微信授权</span>
&#125;</code></pre>
<p>如果你是用vue的hash模式开发的话，当你用微信开发者工具看到微信正确授权回来之后是这样的一个链接。</p>
<pre><code class="highlight pf">http://<span class="number">192.168</span>.<span class="number">1.165</span>/?code=<span class="number">051</span>JpHFa1U8B6A0sfLIa1m5d422JpHFy&amp;<span class="keyword">state</span>=<span class="comment">#/activity</span></code></pre>
<p>悲剧不？难受不？这样的code码要自己在链接里获取(<strong>开发环境下是不会跳转到你本地的，上面的代码只是展示用，实际上微信只会跳转到你的线上域名地址</strong>）。那要怎么获取啊？贴心博主给你下面的代码，不求人！</p>
<pre><code class="highlight javascript"><span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@description </span>解析get参数</span>
<span class="comment"> * <span class="doctag">@param <span class="variable">url</span></span></span>
<span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Object&#125;</span></span></span>
<span class="comment"> */</span>
<span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUrlParams</span> (<span class="params">url</span>) </span>&#123;
  <span class="keyword">if</span> (url.includes(<span class="string">'?'</span>)) &#123;
    <span class="keyword">const</span> str = url.split(<span class="string">'?'</span>)[<span class="number">1</span>].split(<span class="string">'#'</span>)[<span class="number">0</span>]
    <span class="keyword">const</span> arr = str.split(<span class="string">'&amp;'</span>)
    <span class="keyword">const</span> obj = &#123;&#125;
    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;
      obj[arr[i].split(<span class="string">'='</span>)[<span class="number">0</span>]] = arr[i].split(<span class="string">'='</span>)[<span class="number">1</span>]
    &#125;
    <span class="keyword">return</span> obj
  &#125; <span class="keyword">else</span> &#123;
    <span class="keyword">return</span> &#123;&#125;
  &#125;
&#125;</code></pre>
<p>只要你把上面的一整个链接直接放到这个方法里面，他就会返回一个Object对象给你。用上面的链接的话返回的就是下面的。</p>
<pre><code class="highlight pf">const obj = &#123;
	code:<span class="number">051</span>JpHFa1U8B6A0sfLIa1m5d422JpHFy,
	<span class="keyword">state</span>:<span class="string">""</span>
&#125;</code></pre>
<p>这时候你只需要将code码发送给你的后端，让他返回给你openid就可以了。<strong>当然这个方法不止是这么用的，当你分享需要带参数的时候，这个方法就可以放在跳转到微信授权之前直接调用，然后你就把传过来的参数直接保存到本地储存。为什么要这么做？没错，微信会把你的链接截取的不成人样，所以只能这样保存参数了。</strong></p>
<h2 id="二、获取config配置以及如何携带参数"><a href="#二、获取config配置以及如何携带参数" class="headerlink" title="二、获取config配置以及如何携带参数"></a>二、获取config配置以及如何携带参数</h2><p>这里如何引入微信的JSSDK就不再说了，可以通过npm下载包或者是script标签引入。如下：</p>
<pre><code class="highlight coffeescript"><span class="built_in">npm</span> i -S weixin-js-sdk</code></pre>
<p>又或者</p>
<pre><code class="highlight xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://res.wx.qq.com/open/js/jweixin-1.6.0.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>    vue项目的话请写在index.html页面</code></pre>
<h4 id="2-1-config配置注入"><a href="#2-1-config配置注入" class="headerlink" title="2.1  config配置注入"></a>2.1  config配置注入</h4><p>那么我们就进行第三步！就是config配置注入。原理就是我们通过接口给后端传递<strong>url</strong>地址(<strong>必须与上面公众号配置的安全域名一致！</strong>)，后端通过微信的接口获取到config配置，具体为什么这么做呢？就是为了安全，不泄露你的公众号的某些信息。然后我们就填到下面的方法。</p>
<pre><code class="highlight less"><span class="selector-tag">wx</span><span class="selector-class">.config</span>(&#123;
  <span class="attribute">debug</span>: true, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span>
  <span class="attribute">appId</span>: <span class="string">''</span>, <span class="comment">// 必填，公众号的唯一标识</span>
  <span class="attribute">timestamp</span>: , <span class="comment">// 必填，生成签名的时间戳</span>
  <span class="attribute">nonceStr</span>: <span class="string">''</span>, <span class="comment">// 必填，生成签名的随机串</span>
  <span class="attribute">signature</span>: <span class="string">''</span>,<span class="comment">// 必填，签名</span>
  <span class="attribute">jsApiList</span>: [<span class="string">'updateTimelineShareData'</span>, <span class="string">'updateAppMessageShareData'</span>] <span class="comment">// 必填，需要使用的JS接口列表</span>
&#125;);</code></pre>
<p>这里我需要的是微信好友分享以及微信朋友圈分享，更多的接口可以查询<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#10" target="_blank" rel="noopener">微信接口文档</a>。<strong>这是需要特别提醒的是，配置成功后直接调用wx.ready事件</strong><br><img data-sizes="auto" data-src="https://img-blog.csdnimg.cn/20201207111033878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" class="lazyload"><br>一般调试的时候都会打开debug。就是config里面的那个，方便查看config配置成功与否。</p>
<h4 id="2-2-分享链接带参数"><a href="#2-2-分享链接带参数" class="headerlink" title="2.2 分享链接带参数"></a>2.2 分享链接带参数</h4><p>如果是简单的分享网页的话，其实不需要做这些步骤。因为微信内置就可以分享网页，只是不会携带任何东西而已，如果是绑定上下级关系的时候，就需要用到自定义分享去配置。前面说到的<strong>getUrlParams</strong>方法就起了重大作用，用来保存携带过来的参数，那么参数我们需要怎么拼接呢？首先有一点需要明确的是，微信授权回来以后，你的网址链接一般都是长这样的：</p>
<pre><code class="highlight pf">http://<span class="number">192.168</span>.<span class="number">1.153</span>/?code=<span class="number">051</span>JpHFa1U8B6A0sfLIa1m5d422JpHFy&amp;<span class="keyword">state</span>=<span class="comment">#/invite</span></code></pre>
<p>没错，会一直携带微信授权回来的东西(博主用的是vue的hash模式，默认将路由地址加在后面)，那么我们需要拼接出来的地址是怎么样的？如下：</p>
<pre><code class="highlight dts"><span class="symbol">http:</span><span class="comment">//192.168.1.153/?spoorerid=100&amp;inviteuserid=1144</span></code></pre>
<p>没错，微信的官方文档中，特别提醒了<strong>我们的链接不能携带#号后面的东西</strong>。详情请看<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#66" target="_blank" rel="noopener">这里</a><br><img data-sizes="auto" data-src="https://img-blog.csdnimg.cn/20201207112249794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTU5MjI5,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" class="lazyload"><br>明确标签可以通过？的get方式携带参数，那么我们只要配置成这样就完事了。直接如何配置不做任何示例，我的方法就是，用一个变量拼接参数。如拼接成 <strong>?spoorerid=100&amp;inviteuserid=1144</strong>，然后拼成一个完整的链接。如下：</p>
<pre><code class="highlight pgsql">const link = (<span class="keyword">window</span>.<span class="keyword">location</span>.href).replace(<span class="keyword">window</span>.<span class="keyword">location</span>.<span class="keyword">search</span>, addlink).split(<span class="string">'#'</span>)[<span class="number">0</span>]
// 其中addlink就是上面说的变量。拼出来的结果在上面已经展示了。</code></pre>

<h2 id="三、分享操作"><a href="#三、分享操作" class="headerlink" title="三、分享操作"></a>三、分享操作</h2><p>基本上做完上面的工作就可以去分享了，但是！众所周知，ios跟安卓一直有这微妙的关系！没错，如果你是像博主一样，点击了分享以后，才去获取config配置的话，那么恭喜你，安卓是可以的，但是ios的就是不行！不管是在微信开发者工具多少次的成功，你ios这样做就是不行。下面提供两种方法。</p>
<h4 id="3-1-全局配置"><a href="#3-1-全局配置" class="headerlink" title="3.1 全局配置"></a>3.1 全局配置</h4><p>实现起来很简单，就是直接在app.vue里把微信JSSDK的东西都写上，包括获取config配置，还有就是ready里面的东西都写上，直接在mounted调用一下就可以了。但是这样的弊端就是，假如需求是指定某个页面才能分享操作，这样写的话就会单页面里的任何一个页面都可以分享，这是我们不想要的。</p>
<h4 id="3-2-独立配置-指定某个页面分享"><a href="#3-2-独立配置-指定某个页面分享" class="headerlink" title="3.2 独立配置(指定某个页面分享)"></a>3.2 独立配置(指定某个页面分享)</h4><p>上面说到，如果点击触发事件的时候才去获取config配置等等，在ios是不行的。经过不断的尝试以及是查询(其实是问了某个高手)，当你跳转到那个需要分享的页面时，你不能使用<strong>this.$router.push()</strong>的方式去跳转，在hash模式下，其实页面是不做任何跳转的，这就导致了在ios中不能获取到配置项。这时候，原生的东西就起了关键作用：</p>
<pre><code class="highlight pgsql"><span class="keyword">window</span>.<span class="keyword">location</span>.href = <span class="keyword">window</span>.<span class="keyword">location</span>.href.split(<span class="string">'#'</span>)[<span class="number">0</span>] + <span class="string">'#/invite'</span></code></pre>
<p>通过下面的方式跳转到分享页，页面是相当于刷新了一次，这时候在ios就能获取到相关配置了。可以参考<a href="https://www.cnblogs.com/dream111/p/13520017.html" target="_blank" rel="noopener">这个文章</a>。</p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><pre><code class="highlight javascript"><span class="keyword">import</span> wx <span class="keyword">from</span> <span class="string">'weixin-js-sdk'</span>
<span class="keyword">import</span> &#123; getWxConfig &#125; <span class="keyword">from</span> <span class="string">'../api/user'</span>

<span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">wxShare</span>(<span class="params"></span>) </span>&#123;
  <span class="keyword">const</span> params = &#123;
    type: <span class="number">1</span>,
    url: <span class="built_in">window</span>.location.href.split(<span class="string">'#'</span>)[<span class="number">0</span>]
  &#125;
  <span class="comment">// let link = (window.location.href).replace(window.location.search, '').split('#')[0]</span>
  <span class="keyword">let</span> addlink = <span class="string">''</span>
  <span class="keyword">const</span> query = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">'firstQuery'</span>))
  <span class="keyword">const</span> user = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">'User-Info'</span>))
  <span class="keyword">const</span> counselor = <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">'counselor'</span>))
  <span class="keyword">if</span> (query.spoorerid) &#123;
    addlink += <span class="string">`?spoorerid=<span class="subst">$&#123;query.spoorerid&#125;</span>`</span>
    <span class="keyword">if</span> (user &amp;&amp; user.id) &#123;
      addlink += <span class="string">`&amp;inviteuserid=<span class="subst">$&#123;user.id&#125;</span>`</span>
    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (query.inviteuserid) &#123;
      addlink += <span class="string">`&amp;inviteuserid=<span class="subst">$&#123;query.inviteuserid&#125;</span>`</span>
    &#125; <span class="keyword">else</span> &#123;
      addlink += <span class="string">'&amp;inviteuserid=0'</span>
    &#125;
  &#125; <span class="keyword">else</span> &#123;
    addlink += <span class="string">`?spoorerid=<span class="subst">$&#123;counselor.id&#125;</span>`</span>
    <span class="keyword">if</span> (user &amp;&amp; user.id) &#123;
      addlink += <span class="string">`&amp;inviteuserid=<span class="subst">$&#123;user.id&#125;</span>`</span>
    &#125;
  &#125;
  <span class="keyword">const</span> link = (<span class="built_in">window</span>.location.href).replace(<span class="built_in">window</span>.location.search, addlink).split(<span class="string">'#'</span>)[<span class="number">0</span>]
  <span class="comment">// console.log('addlink', addlink)</span>
  <span class="comment">// console.log('link', link)</span>
  getWxConfig(params).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;
    <span class="keyword">if</span> (res.code === <span class="number">200</span>) &#123;
      wx.config(&#123;
        debug: <span class="literal">false</span>,
        appId: res.data.appid,
        timestamp: res.data.timestamp,
        nonceStr: res.data.nonceStr,
        signature: res.data.signature,
        jsApiList: [<span class="string">'updateTimelineShareData'</span>, <span class="string">'updateAppMessageShareData'</span>]
      &#125;)
    &#125;
  &#125;)
  wx.ready(<span class="function"><span class="params">()</span> =&gt;</span> &#123;
    <span class="keyword">const</span> shareObj = &#123;
      title: <span class="string">'*******'</span>,
      link: link,
      imgUrl: <span class="string">'http://hteshb.beegoedu.com/share.png'</span>,
      desc: <span class="string">'你也一起来跟我携手上进吧'</span>,
      success() &#123;
        <span class="built_in">console</span>.log(<span class="string">'分享成功'</span>)
      &#125;,
      fail() &#123;
        <span class="built_in">console</span>.log(<span class="string">'分享失败'</span>)
      &#125;
    &#125;
    <span class="comment">// 分享给朋友</span>
    wx.updateAppMessageShareData(shareObj)
    <span class="comment">// 分享到朋友圈</span>
    wx.updateTimelineShareData(shareObj)
  &#125;)
  wx.error(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;
    <span class="comment">// config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。</span>
    <span class="built_in">console</span>.log(<span class="string">'失败返回参数'</span>, res)
  &#125;)
&#125;</code></pre>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>好了，花了两三个小时终于是整理完了这文章。如果觉得有用，喜欢收藏或者点个喜欢，毕竟这是博主搜了一个多星期百度的结果，希望能帮到大家永不加班，到点就走！</p>

  </article>

  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/web%E5%89%8D%E7%AB%AF/">web前端</a>
    
    
        <a class="nexmoefont icon-tag-fill -link" href="/tags/Wx%E7%94%9F%E6%80%81%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/" rel="tag">Wx生态的那些事</a>
    
</div>

  <!-- 开启评论和文章版权声明 -->
  <div class="nexmoe-post-footer">
    <!-- 
      
  <div class="nexmoe-post-copyright">
    
    <strong>本文作者：</strong>RadiomM<br>
    <strong>本文链接：</strong><a href="http://yoursite.com/2020/12/07/%E5%AE%89%E5%8D%93%E3%80%81ios%E5%BE%AE%E4%BF%A1H5%E5%88%86%E4%BA%AB%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97/" title="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;12&#x2F;07&#x2F;%E5%AE%89%E5%8D%93%E3%80%81ios%E5%BE%AE%E4%BF%A1H5%E5%88%86%E4%BA%AB%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;12&#x2F;07&#x2F;%E5%AE%89%E5%8D%93%E3%80%81ios%E5%BE%AE%E4%BF%A1H5%E5%88%86%E4%BA%AB%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97&#x2F;</a><br>
    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


     -->
    <!-- comment开启文章评论 -->
     
  </div>
</div>
    </div>
  </div>
  <div id="music-wrapper"></div>
<script
    src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js,gh/nexmoe/nexmoe.github.io@latest/js/app.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--<script src="/js/app.js?v=1633917914767"></script>-->


<script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>



<script src="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/js/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/architectMymine/architectMymine.github.io@latest/js/aplayer.js"></script>

  





    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?1f8c7b61089021ddab0a2109105def2b';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>